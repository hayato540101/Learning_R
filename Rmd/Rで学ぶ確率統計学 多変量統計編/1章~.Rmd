---
title: "Rで学ぶ確率統計学 多変量統計編"
author: "TH"
output:
  html_document:
    theme: darkly
    toc: true
    number_sections: true
---

```{r}
library(styler)
style_file("C:/Users/thyt/Learning/Learning_R/Rmd/Rで学ぶ確率統計学 多変量統計編/なんでも.R")
```
<!-- style_file("C:/Users/thyt/Learning/Learning_R/Rmd/Rで学ぶ確率統計学 多変量統計編/なんでも.R") -->

# １章

## 適合度検定
```{r, fig.height = 7, fig.width = 7, fig.align = "center", fig.cap = "", dpi = 72}
nankai <- data.frame(month = 1:12, frequency=c(0,2,0,0,0,0,0,2,1,1,1,5))

barplot(height = nankai$frequency,
        names.arg = nankai$month, xlab = "month", ylab = "frequency")

chisq.test(nankai$frequency,p=rep(1/12,length=12))
```

$$結論　帰無仮説H_0:各々の月に地震が起きる確率が12分の1は棄却される。$$

```{r, fig.height = 7, fig.width = 7, fig.align = "center", fig.cap = "", dpi = 72}

# accident_count 事故回数
# year_count 該当する年の数

df <- data.frame(accident_count = 0:8, year_count=c(1,6,6,8,5,7,0,1,0))
m <- sum((0:8)*df$year_count)/sum(df$year_count)

print(paste("最尤推定量λ:",m))

```
$$事故回数を8回以上と解釈した場合(自由度8)の検定$$

```{r, fig.height = 7, fig.width = 7, fig.align = "center", fig.cap = "", dpi = 72}
poisprob<-dpois(0:7,lambda=m)
theory<-c(poisprob,1-sum(poisprob))
chisq.test(df$year_count,p=theory)
```
$$9回以上の実現値を0と解釈した場合(自由度9)の検定$$
```{r, fig.height = 7, fig.width = 7, fig.align = "center", fig.cap = "", dpi = 72}
poisprob2<-dpois(0:8,lambda=m)
theory2<-c(poisprob2,1-sum(poisprob2))
years2<-c(df$year_count,0)

chisq.test(years2,p=theory2)
```

$$χ二乗統計量の分布$$

```{r, fig.height = 7, fig.width = 7, fig.align = "center", fig.cap = "", dpi = 72}
N <- 1000
p <- c(4,3,2,1)/10
x <- rmultinom(N, size=10, prob=p)
expmatrix <- rep(N*p,N)
z <- x - expmatrix
chisqval <- apply(z*z/expmatrix, 2, sum)
hist(chisqval)
```



# ２章 分割表の検定(2)

- サマリ
 - chisq.test(df) # イエーツの補正あり
 - chisq.test(df,correct=FALSE)  # イエーツの補正なし
 - fisher.test(df)  # フィッシャーの正確検定

```{r, fig.height = 7, fig.width = 7, fig.align = "center", fig.cap = "", dpi = 72}
library(MASS)

SmokeEx <- table(survey$Smoke, survey$Exer)

chisq.test(SmokeEx)
```

### イエーツの補正有無でP値を比較
```{r, fig.height = 7, fig.width = 7, fig.align = "center", fig.cap = "", dpi = 72}

sb<-matrix(c(1085,703,55623,441239),2,2)
chisq.test(sb,correct=FALSE)

# correct=TRUE
chisq.test(sb)
```

### 母比率の差の検定
```{r, fig.height = 7, fig.width = 7, fig.align = "center", fig.cap = "", dpi = 72}
prop.test(c(8,13),c(20,20))

bluepen<-matrix(c(8,12,13,7),2,2)
chisq.test(bluepen)
```
### フィッシャーの正確検定
```{r, fig.height = 7, fig.width = 7, fig.align = "center", fig.cap = "", dpi = 72}
fisher.test(bluepen)
```
### フィッシャーの正確検定の計算原理　SKIP

### 独立性の検定が役に立つ場合
```{r, fig.height = 7, fig.width = 7, fig.align = "center", fig.cap = "", dpi = 72}
mrecall<-matrix(c(14,17,6,2),2,2)

chisq.test(mrecall)
chisq.test(mrecall,correct=FALSE)  # イエーツの補正なし

fisher.test(mrecall)

```
### 残渣分析
```{r, fig.height = 7, fig.width = 7, fig.align = "center", fig.cap = "", dpi = 72}
MF <- matrix(c(482, 532, 303, 390, 30, 38, 29, 62), 4, 2,
  dimnames = list(c("機械", "電気", "電子", "環境"), c("男性", "女性"))
)

res <- chisq.test(MF)
res$stdres



```

```{r, fig.height = 7, fig.width = 7, fig.align = "center", fig.cap = "", dpi = 72}
```
```{r, fig.height = 7, fig.width = 7, fig.align = "center", fig.cap = "", dpi = 72}
```
```{r, fig.height = 7, fig.width = 7, fig.align = "center", fig.cap = "", dpi = 72}
```
```{r, fig.height = 7, fig.width = 7, fig.align = "center", fig.cap = "", dpi = 72}
```
```{r, fig.height = 7, fig.width = 7, fig.align = "center", fig.cap = "", dpi = 72}
```
```{r, fig.height = 7, fig.width = 7, fig.align = "center", fig.cap = "", dpi = 72}
```
```{r, fig.height = 7, fig.width = 7, fig.align = "center", fig.cap = "", dpi = 72}
```
```{r, fig.height = 7, fig.width = 7, fig.align = "center", fig.cap = "", dpi = 72}
```
```{r, fig.height = 7, fig.width = 7, fig.align = "center", fig.cap = "", dpi = 72}
```
```{r, fig.height = 7, fig.width = 7, fig.align = "center", fig.cap = "", dpi = 72}
```
```{r, fig.height = 7, fig.width = 7, fig.align = "center", fig.cap = "", dpi = 72}
```
```{r, fig.height = 7, fig.width = 7, fig.align = "center", fig.cap = "", dpi = 72}
```
```{r, fig.height = 7, fig.width = 7, fig.align = "center", fig.cap = "", dpi = 72}
```
```{r, fig.height = 7, fig.width = 7, fig.align = "center", fig.cap = "", dpi = 72}
```
```{r, fig.height = 7, fig.width = 7, fig.align = "center", fig.cap = "", dpi = 72}
```
```{r, fig.height = 7, fig.width = 7, fig.align = "center", fig.cap = "", dpi = 72}
```
```{r, fig.height = 7, fig.width = 7, fig.align = "center", fig.cap = "", dpi = 72}
```
```{r, fig.height = 7, fig.width = 7, fig.align = "center", fig.cap = "", dpi = 72}
```
```{r, fig.height = 7, fig.width = 7, fig.align = "center", fig.cap = "", dpi = 72}
```
```{r, fig.height = 7, fig.width = 7, fig.align = "center", fig.cap = "", dpi = 72}
```
$$$$
$$$$